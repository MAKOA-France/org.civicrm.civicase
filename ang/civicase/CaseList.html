<div crm-ui-debug="cases"></div>
<div crm-ui-debug="caseTypes"></div>
<div crm-ui-debug="caseStatuses"></div>
<div id="bootstrap-theme">

  <div class="panel panel-default case-list-panel">

    <table class="case-list-table">
      <thead>
        <tr>
          <th>
            <div class="case-list-checkbox">
              <input type="checkbox" ng-click="selectAll($event)" ng-checked="isSelection('all')" />
            </div>
            <div class="btn-group btn-group-sm">
              <button type="button" class="btn btn-default dropdown-toggle {{ isSelection('any') ? '' : 'disabled' }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                {{ ts('Actions') }}
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li><a href>{{ ts('Add Role') }}</a></li>
                <li><a href>{{ ts('Reassign Cases') }}</a></li>
                <li><a href>{{ ts('Delete Cases') }}</a></li>
                <li class="{{ isSelection(2) ? '' : 'disabled' }}"><a href>{{ ts('Merge 2 Cases') }}</a></li>
              </ul>
            </div>
          </th>
          <th>{{ ts('Subject') }}</th>
          <th>{{ ts('Status') }}</th>
          <th>{{ ts('Type') }}</th>
          <th>{{ ts('Case Manager') }}</th>
          <th>{{ ts('My Role') }}</th>
          <th>{{ ts('Next Milestone') }}</th>
          <th>{{ ts('Next Task') }}</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="case in cases">
          <td>
            <div class="case-list-checkbox">
              <input type="checkbox" ng-model="case.selected" />
            </div>
            <div>
              <h4>
                {{ case.client[0].sort_name }}
                <span class="badge overdue-activities" ng-if="case.activities.overdue.length" title="{{ ts('Overdue activities') }}">
                  {{ case.activities.overdue.length }}
                </span>
              </h4>
              <div ng-if="case.client[0].email">
                <strong>{{ ts('Email:') }}</strong>
                {{ case.client[0].email }}
              </div>
              <div ng-if="case.client[0].phone">
                <strong>{{ ts('Phone:') }}</strong>
                {{ case.client[0].phone }}
              </div>
              <div>
                <strong>{{ ts('Case ID:') }}</strong>
                {{ case.id }}
              </div>
              <div ng-if="case.activities.alert.length" class="case-alerts">
                <i class="crm-i fa-exclamation-triangle"></i>
                {{ case.activities.alert.length }}
              </div>
            </div>
          </td>
          <td>{{ case.subject }}</td>
          <td>{{ case.status }}</td>
          <td>{{ case.case_type }}</td>
          <td>{{ case.manager.display_name }}</td>
          <td>{{ case.myRole.join(', ') }}</td>
          <td>
            <div ng-if="case.activities.milestone.length">
              <div>{{ activityTypes[case.activities.milestone[0].activity_type_id].label }}</div>
              <div>{{ CRM.utils.formatDate(case.activities.milestone[0].activity_date_time) }}</div>
            </div>
          </td>
          <td>
            <div ng-if="case.activities.task.length">
              <div>{{ activityTypes[case.activities.task[0].activity_type_id].label }}</div>
              <div>{{ CRM.utils.formatDate(case.activities.task[0].activity_date_time) }}</div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="text-center" ng-include="'~/civicase/Pager.html'"></div>
  </div>
</div>
