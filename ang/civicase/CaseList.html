<div crm-ui-debug="cases"></div>
<div id="bootstrap-theme">

  <div class="panel panel-default case-list-panel">

    <table class="case-list-table">
      <thead>
        <tr>
          <th>
            <div class="case-list-checkbox">
              <input type="checkbox" ng-click="selectAll($event)" ng-checked="isSelection('all')" />
            </div>
            <div class="btn-group btn-group-sm">
              <button type="button" class="btn btn-default dropdown-toggle {{ isSelection('any') ? '' : 'disabled' }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                {{ ts('Actions') }}
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <li><a href>{{ ts('Add Role') }}</a></li>
                <li><a href>{{ ts('Reassign Cases') }}</a></li>
                <li><a href>{{ ts('Delete Cases') }}</a></li>
                <li class="{{ isSelection(2) ? '' : 'disabled' }}"><a href>{{ ts('Merge 2 Cases') }}</a></li>
              </ul>
            </div>
          </th>
          <th>{{ ts('Subject') }}</th>
          <th>{{ ts('Status') }}</th>
          <th>{{ ts('Type') }}</th>
          <th>{{ ts('Case Manager') }}</th>
          <th>{{ ts('My Role') }}</th>
          <th>{{ ts('Next Milestone') }}</th>
          <th>{{ ts('Next Task') }}</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="item in cases">
          <td>
            <div class="case-list-checkbox">
              <input type="checkbox" ng-model="item.selected" />
            </div>
            <div>
              <h4>
                {{ item.client[0].display_name }}
                <div class="btn-group btn-group-sm" ng-if="item.client.length > 1">
                  <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="{{ ts('Additional clients') }}">
                    +{{ item.client.length - 1 }}
                  </button>
                  <ul class="dropdown-menu" >
                    <li ng-repeat="(index, client) in item.client" ng-if="index">
                      <span>{{ client.display_name }}</span>
                    </li>
                  </ul>
                </div>
                <span class="badge overdue-activities" ng-if="item.activity_summary.overdue.length" title="{{ ts('Overdue activities') }}">
                  {{ item.activity_summary.overdue.length }}
                </span>
              </h4>
              <div ng-if="item.client[0].email">
                <strong>{{ ts('Email:') }}</strong>
                {{ item.client[0].email }}
              </div>
              <div ng-if="item.client[0].phone">
                <strong>{{ ts('Phone:') }}</strong>
                {{ item.client[0].phone }}
              </div>
              <div>
                <strong>{{ ts('Case ID:') }}</strong>
                {{ item.id }}
              </div>
              <div ng-if="item.activity_summary.alert.length" class="case-alerts">
                <i class="crm-i fa-exclamation-triangle"></i>
                {{ item.activity_summary.alert.length }}
              </div>
            </div>
          </td>
          <td>{{ item.subject }}</td>
          <td>{{ item.status }}</td>
          <td>{{ item.case_type }}</td>
          <td>{{ item.manager.display_name }}</td>
          <td>{{ item.myRole.join(', ') }}</td>
          <td>
            <div ng-if="item.activity_summary.milestone.length">
              <div>{{ activityTypes[item.activity_summary.milestone[0].activity_type_id].label }}</div>
              <div>{{ CRM.utils.formatDate(item.activity_summary.milestone[0].activity_date_time) }}</div>
            </div>
          </td>
          <td>
            <div ng-if="item.activity_summary.task.length">
              <div>{{ activityTypes[item.activity_summary.task[0].activity_type_id].label }}</div>
              <div>{{ CRM.utils.formatDate(item.activity_summary.task[0].activity_date_time) }}</div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="text-center" ng-include="'~/civicase/Pager.html'"></div>
  </div>
</div>
