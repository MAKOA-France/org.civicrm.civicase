<div crm-ui-debug="activities"></div>
<div id="bootstrap-theme">

  <div class="panel panel-default act-feed-panel">
    <div class="panel-header">
      <form class="form-inline act-filters">
        <div class="btn-group btn-group-sm">
          <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown">{{ ts('Filters') }} &nbsp; <span class="caret"></span></button>
          <ul class="dropdown-menu" role="menu">
            <li ng-repeat="(name, label) in availableFilters">
              <input type="checkbox" id="availableFilter_{{ name }}" ng-model="exposedFilters[name]" />
              <label for="availableFilter_{{ name }}">{{ label }}</label>
            </li>
          </ul>
        </div>
        <input class="form-control" crm-ui-select="{allowClear: true, multiple: true, placeholder: availableFilters.activity_type_id, data: activityTypeOptions}" ng-model="filters.activity_type_id" ng-show="exposedFilters.activity_type_id" />
        <input class="form-control" crm-ui-select="{allowClear: true, multiple: true, placeholder: availableFilters.status_id, data: activityStatusOptions}" ng-model="filters.status_id" ng-show="exposedFilters.status_id" />
        <input type="search" class="form-control" placeholder="{{ ts('Subject') }}" ng-model="filters.subject" ng-show="exposedFilters.subject" />
        <input type="search" class="form-control" placeholder="{{ ts('Details') }}" ng-model="filters.details" ng-show="exposedFilters.details" />
        <input class="form-control" crm-entityref="{entity: 'Contact', select: {allowClear: true, multiple: true, placeholder: ts('With')}}" ng-model="filters.target_contact_id" ng-show="exposedFilters.target_contact_id" />
        <input class="form-control" crm-entityref="{entity: 'Contact', select: {allowClear: true, multiple: true, placeholder: ts('Assigned to')}}" ng-model="filters.assignee_contact_id" ng-show="exposedFilters.assignee_contact_id" />
        <input class="form-control" crm-entityref="{entity: 'Tag', api: {params: {used_for: {LIKE: '%civicrm_activity%'}}}, select: {allowClear: true, multiple: true, placeholder: ts('Tagged')}}" ng-model="filters.tag_id" ng-show="exposedFilters.tag_id" />
        <input class="form-control" crm-entityref="{entity: 'Campaign', select: {allowClear: true, multiple: true, placeholder: ts('Campaign')}}" ng-model="filters.campaign_id" ng-show="exposedFilters.campaign_id" />
      </form>
    </div>
    <div class="panel-body">
      <ul class="list-group act-feed-list-group">
        <li class="list-group-item act-category-{{ activity.category.join(' act-category-') || 'none' }} {{ activity.is_completed ? 'is-completed' : 'is-incomplete' }}" ng-repeat="activity in activities">
          <h4 class="act-date" ng-if="!isSameDate(activity.activity_date_time, activities[$index-1].activity_date_time)">
            {{ CRM.utils.formatDate(activity.activity_date_time) }}
          </h4>
          <div class="act-feed-item" style="border-left-color: {{ activity.color }}; border-right-color: {{ activity.color }};">
            <div class="act-feed-inner">
              <div class="cb-dot" title="{{ activity.type }} ({{ activity.status }})" style="background-color: {{ activity.color }};">
                <i ng-if="activity.icon" class="fa {{ activity.icon }}"></i>
                <strong ng-if="!activity.icon">{{ activity.type[0] }}</strong>
              </div>
              <div class="act-task-checkbox" ng-if="activity.category.indexOf('task') > -1" ng-click="markCompleted(activity)" title="{{ activity.is_completed ? ts('Mark incomplete') : ts('Mark complete') }}">
                <i class="fa fa-{{ activity.is_completed ? 'check-' : '' }}square-o"></i>
              </div>
              <div class="act-actions-menu btn-group btn-group-sm">
                <button type="button" class="btn btn-default dropdown-toggle act-actions-button" data-toggle="dropdown" title="{{ ts('Actions') }}">
                  <span class="crm-i fa-ellipsis-v"></span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" role="menu">
                  <li><a class="crm-popup" href="{{ CRM.url('civicrm/activity', {action: 'view', id: activity.id, reset: 1, atype: activity.activity_type_id}) }}">{{ ts('View') }}</a></li>
                  <li><a class="crm-popup" href="{{ CRM.url('civicrm/activity/add', {action: 'update', id: activity.id, reset: 1, atype: activity.activity_type_id}) }}">{{ ts('Edit') }}</a></li>
                  <li><a class="crm-popup small-popup" href="{{ CRM.url('civicrm/activity', {action: 'delete', id: activity.id, reset: 1, atype: activity.activity_type_id}) }}">{{ ts('Delete') }}</a></li>
                </ul>
              </div>
              <h4>
                <span class="act-subject" ng-if="activity.subject">{{ activity.subject }}</span>
                <span class="act-subject" ng-if="!activity.subject">{{ activity.type }}</span>
                <a class="act-star crm-i" ng-click="star(activity)" href ng-if="activity.category.indexOf('alert') < 0">
                  <i class="crm-i fa-star-o" ng-if="activity.is_star === '0'" title="{{ ts('Add star') }}"></i>
                  <i class="crm-i fa-star" ng-if="activity.is_star === '1'" title="{{ ts('Unstar') }}"></i>
                </a>
                <a class="act-attachment fa fa-paperclip" ng-repeat="file in activity['api.Attachment.get'].values" title="{{ file.name }}" href="{{ file.url }}">
                </a>
              </h4>
              <div class="act-tags">
                <span
                  class="label label-default"
                  ng-repeat="tag in activity['api.EntityTag.get'].values"
                  style="background-color: {{ tag['tag_id.color'] }};"
                  title="{{ tag['tag_id.description'] }}"
                >
                  {{ tag['tag_id.name'] }}
                </span>
              </div>
              <div class="act-details" ng-bind-html="activity.details"></div>
              <div class="act-contacts clearfix">
                <div class="act-contacts-target" ng-if="activity.target_contact_name">
                  <strong>{{ ts('With:') }}</strong>
                  <span ng-repeat="(cid, display_name) in activity.target_contact_name">
                    <a href="{{ CRM.url('civicrm/contact/view', {cid:cid}) }}">{{ display_name }}</a>
                    {{$last ? '' : ', '}}
                  </span>
                </div>
                <div class="act-contacts-assignee" ng-if="activity.assignee_contact_name">
                  <strong>{{ ts('Assigned to:') }}</strong>
                  <span ng-repeat="(cid, display_name) in activity.assignee_contact_name">
                    <a href="{{ CRM.url('civicrm/contact/view', {cid:cid}) }}">{{ display_name }}</a>
                    {{$last ? '' : ', '}}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>
